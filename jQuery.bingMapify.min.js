var XmlHttpRequest=XMLHttpRequest,mapType={arial:Microsoft.Maps.MapTypeId.arial,auto:Microsoft.Maps.MapTypeId.auto,birdseye:Microsoft.Maps.MapTypeId.birdseye,collinsBart:Microsoft.Maps.MapTypeId.collinsBart,mercator:Microsoft.Maps.MapTypeId.mercator,ordnanceSurvey:Microsoft.Maps.MapTypeId.ordnanceSurvey,road:Microsoft.Maps.MapTypeId.road};(function(a){"use strict";var f=function(b,a){return b.replace(/\{\{|\}\}|\{(\w+)\}/g,function(b,c){return b==="{{"?"{":b==="}}"?"}":a[c]})},d={bingMapCredentials:null,mapPins:[{lat:"38.685509760012",lon:"-96.50390625",title:"",location:"",address:"",pinNumber:null}],mapTypeId:mapType.auto,zoom:10,enableClickableLogo:true,enableSearchLogo:true,showCopyright:true,showDashboard:true,showLogo:true,infoBox:{enabled:true,formatHtmlContent:'<div class="infoBox"><h1>{title}</h1><hr>{location}<br>{address}</div>',visibleOnLoad:false}},b=Microsoft.Maps;function e(a){return Object.prototype.toString.call(a)==="[object Array]"}function c(b){var a=new XmlHttpRequest;a.open("GET",b,false);a.setRequestHeader("X-Requested-With","XMLHttpRequest");a.send(null);try{return a.responseText}catch(c){return""}}a.fn.bingMapify=function(m){var g=a.extend({},d,m),h=null,i=null;if(g.bingMapCredentials===null)throw new Error("Please supply your bingMapCredentials");function l(a,e){var c,d=new b.Pushpin(new Microsoft.Maps.Location(a.lat,a.lon),{text:e.toString()});if(g.infoBox.enabled){c={htmlContent:f(g.infoBox.formatHtmlContent,a),visible:g.infoBox.visibleOnLoad};i=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(a.lat,a.lon),c);Microsoft.Maps.Events.addHandler(h,"click",j);Microsoft.Maps.Events.addHandler(d,"click",k)}h.entities.push(d);h.entities.push(i)}function k(f){if(f.targetType==="pushpin"){i.setOptions({visible:true,offset:new Microsoft.Maps.Point(-10,25)});i.setLocation(f.target.getLocation());var b=25,g=i.getOffset(),e=i.getAnchor(),d=h.tryLocationToPixel(f.target.getLocation(),Microsoft.Maps.PixelReference.control),a=d.x+g.x-e.x,c=d.y-25-e.y;if(c<b){c*=-1;c+=b}else c=0;if(a<b){a*=-1;a+=b}else{a=h.getWidth()-d.x+e.x-i.getWidth();if(a>b)a=0;else a-=b}(a!==0||c!==0)&&h.setView({centerOffset:new Microsoft.Maps.Point(a,c),center:h.getCenter()})}}function j(){i.setOptions({visible:false})}return this.each(function(){var j=0,f,i=[],d;h=new b.Map(this,{credentials:g.credentials,mapTypeId:g.mapTypeId,zoom:g.zoom,enableClickableLogo:g.enableClickableLogo,enableSearchLogo:g.enableSearchLogo,showCopyright:g.showCopyright,showDashboard:g.showDashboard,showLogo:g.showLogo,infoBoxString:g.infoBoxString});if(e(g.mapPins))d=g.mapPins;else d=JSON.parse(c(g.mapPins));a.each(d,function(){if(typeof this.Lat!=="undefined"){this.lat=this.Lat;this.lon=this.Lon;this.title=this.Title;this.location=this.Location;this.address=this.Address}i[j++]=new Microsoft.Maps.Location(this.lat,this.lon);l(this,j)});f=Microsoft.Maps.LocationRect.fromLocations(i);h.setView({bounds:f})})}})(jQuery)